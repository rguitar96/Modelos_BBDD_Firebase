<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">

<script src="../scripts/main.js"></script>

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="my-icons.html">

<link rel="import" href="../bower_components/iron-behaviors/iron-button-state.html">
<link rel="import" href="../bower_components/paper-input/paper-input-addon-behavior.html">
<link rel="import" href="../bower_components/paper-input/paper-input-behavior.html">
<link rel="import" href="../bower_components/paper-input/paper-input-char-counter.html">

<link rel="import" href="../bower_components/iron-checked-element-behavior/iron-checked-element-behavior.html">
<link rel="import" href="../bower_components/iron-form-element-behavior/iron-form-element-behavior.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel = "import" href = "../bower_components/polymerfire/firebase-auth.html">
<link rel = "import" href = "../bower_components/polymerfire/firebase-document.html">

<link rel="import" href="../bower_components/iron-form/iron-form.html">

<script src="../scripts/main.js"></script>
<!--<script src="/__/firebase/3.9.0/firebase-app.js"></script>
<script src="/__/firebase/3.9.0/firebase-auth.js"></script>
<script src="/__/firebase/init.js"></script>
<script src="/__/firebase/3.9.0/firebase-storage.js"></script>-->




<dom-module id="my-insertar-concursante">
    <template>
        <style include="shared-styles">
            :host {
                display: block;

                padding: 10px;
            }
            /*paper-input {
                max-width: 400px;
                margin: auto;
            }
            iron-icon, div[suffix] {
                color: hsl(0, 0%, 50%);
                margin-right: 12px;
            }*/
            .contenedor {
                display: flex;
                max-width: 500px;
                margin: auto;
            }
            .img-perfil {
                height: 150px;
                width: 125px;
                margin-right: 50px;
            }
            paper-toast {
                width: 300px;
                margin-left: calc(50vw - 150px);
            }

        </style>

        <firebase-auth id="auth" user="{{user}}" provider="google" on-error="handleError">
        </firebase-auth>
        <firebase-document
            path="/usuarios/[[user.uid]]"
            data="{{usuario}}">
        </firebase-document>


        <div class="card">
            <!--<div class="circle">1</div>-->
            <paper-toast id="toast" text="Registro insertado"></paper-toast>
            <h1>Insertar Concursante</h1>
            <iron-form id="ironForm">
                <form id="form">
                    <div class="contenedor">
                        <div>
                            <img class="img-perfil" src="{{imagen}}" alt="Logotipo OT" width="800" height="500">
                        </div>
                        <div>
                            <paper-input always-float-label label="Nombre" value="{{nombre}}" required></paper-input>
                            <paper-input always-float-label label="Apellidos" value="{{apellidos}}" required></paper-input>
                            <paper-input always-float-label label="Correo" value="{{correo}}" required>
                                <iron-icon icon="mail" slot="prefix"></iron-icon>
                                <!--<div slot="suffix">@email.com</div>-->
                            </paper-input>
                            <paper-input type="file" id="inputFile" files="{{imagen}}">Selecciona la imagen</paper-input>

                            <paper-button on-click="insertarImagen" class="mdl-button mdl-js-button mdl-button--raised" raised>Guardar</paper-button>

                        </div>

                    </div>
                </form>
            </iron-form>
        </div>

    </template>

    <script>
class InsertarConcursante extends Polymer.Element {
    static get is() {
        return 'my-insertar-concursante';
    }
    static get properties() {
        return {
            user: {
                type: Object,
            },
            nombre: {type: String},
            apellidos: {type: String},
            correo: {type: String},
            imagen: {type: Object},
            usuario: {
                type: Object,
                observer: '_publico'
            },
            checked: {
                type: String,
                notify: true,
                reflectToAttribute: true,
                value: ""
            },
            statusKnown: {
                type: Object
            }
        }
    }
    insertar(urlImg) {
        alert('insertar')
        //if (this.$.ironForm.validate()) {
            alert('validado')
            var claveConcursante = firebase.database().ref().child('concursantes').push().key;
            alert(claveConcursante);
            alert('url: ' + urlImg)
            firebase.database().ref('concursantes/' + claveConcursante).set({
                nombre: this.nombre,
                apellidos: this.apellidos,
                correo: this.correo,
                imagen: urlImg
            });
            this.$.ironForm.reset();
            this.$.toast.open();
       // }
    }
    
    insertarImagen() {
        var storageRef = firebase.storage().ref();
        //var files = document.getElementById('inputFile').files;
        var files = this.$.inputFile.inputElement.inputElement.files;
        //var files = this.$.imagen;
        //alert('files: '+this.imagen);
        //alert(files)

        if (!files.length) {
            alert('Please select a file!');
            return;
        }

        var file = files[0];
        //var file = this.imagen;

        var metadata = {
            'contentType': file.type
        };


        var url='';
        // Push to child path.
        // [START oncomplete]
        storageRef.child('images/' + file.name).put(file, metadata).then(function (snapshot) {
            console.log('Uploaded', snapshot.totalBytes, 'bytes.');
            console.log(snapshot.metadata);
            url = snapshot.downloadURL
            alert('url: ' + url)
            //insertar(url)
            // return url;
            
            console.log('File available at', url);
            // [START_EXCLUDE]
            //document.getElementById('linkbox').innerHTML = '<a href="' + url + '">Click For File</a>';
            // [END_EXCLUDE]
        }).catch(function (error) {
            // [START onfailure]
            alert('uploaded failed');
            console.error('Upload failed:', error);
            // [END onfailure]
        });
        //return url;
    }

    

}

window.customElements.define(InsertarConcursante.is, InsertarConcursante);
    </script>
</dom-module>
